# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"POT-Creation-Date: 2023-10-22 08:05+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. This guide is maintained in the main Quarkus repository
#. and pull requests should be submitted there:
#. https://github.com/quarkusio/quarkus/tree/main/docs/src/main/asciidoc
#. type: Title =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:6
#, no-wrap
msgid "Tips for writing native applications"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:13
msgid "This guide contains various tips and tricks for getting around problems that might arise when attempting to run Java applications as native executables."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:15
msgid "Note that we differentiate two contexts where the solution applied might be different:"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:17
msgid "in the context of an application, you will rely on configuring the `native-image` configuration by tweaking your `pom.xml`;"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:18
msgid "in the context of an extension, Quarkus offers a lot of infrastructure to simplify all of this."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:20
msgid "Please refer to the appropriate section depending on your context."
msgstr ""

#. type: Title ==
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:21
#, no-wrap
msgid "Supporting native in your application"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:24
msgid "GraalVM imposes a number of constraints and making your application a native executable might require a few tweaks."
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:25
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:664
#, no-wrap
msgid "Including resources"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:29
msgid "By default, when building a native executable, GraalVM will not include any of the resources that are on the classpath into the native executable it creates.  Resources that are meant to be part of the native executable need to be configured explicitly."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:31
msgid "Quarkus automatically includes the resources present in `META-INF/resources` (the web resources) but, outside this directory, you are on your own."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:36
msgid "Note that you need to be extremely careful here as anything in `META-INF/resources` will be exposed as static web resources.  So this directory is not a shortcut for \"let's automatically include these resources in the native executable\" and should only be used for static web resources."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:38
msgid "Other resources should be declared explicitly."
msgstr ""

#. type: Title ====
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:40
#, no-wrap
msgid "Using the `quarkus.native.resources.includes` configuration property"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:44
msgid "To include more resources in the native executable, the easiest way is to use the `quarkus.native.resources.includes` configuration property, and its counterpart to exclude resources `quarkus.native.resources.excludes`."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:46
msgid "Both configuration properties support glob patterns."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:48
msgid "For instance, having the following properties in your `application.properties`:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:53
#, no-wrap
msgid ""
"quarkus.native.resources.includes=foo/**,bar/**/*.txt\n"
"quarkus.native.resources.excludes=foo/private/**\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:56
msgid "will include:"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:58
msgid "all files in the `foo/` directory and its subdirectories except for files in `foo/private/` and its subdirectories,"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:59
msgid "all text files in the `bar/` directory and its subdirectories."
msgstr ""

#. type: Title ====
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:60
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:252
#, no-wrap
msgid "Using a configuration file"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:64
msgid "If globs are not sufficiently precise for your use case and you need to rely on regular expressions, or if you prefer relying on the GraalVM infrastructure, you can also create a `resources-config.json` (the most common location is within `src/main/resources`) JSON file defining which resources should be included."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:68
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:259
msgid "Relying on the GraalVM infrastructure means that you are responsible for keeping the configuration file up to date as new Mandrel and GraalVM versions are released."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:70
msgid "Please also note that the `resources-config.json` file will be overwritten by Quarkus if placed directly under `src/main/resources/META-INF/native-image/` as Quarkus generates its own configuration file in this directory."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:73
msgid "An example of such a file is the following:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:86
#, no-wrap
msgid ""
"{\n"
"  \"resources\": [\n"
"    {\n"
"      \"pattern\": \".*\\\\.xml$\"\n"
"    },\n"
"    {\n"
"      \"pattern\": \".*\\\\.json$\"\n"
"    }\n"
"  ]\n"
"}\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:90
msgid "The patterns are valid Java regexps.  Here we include all the XML files and JSON files into the native executable."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:94
msgid "For more information about this topic, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/dynamic-features/Resources/[GraalVM Accessing Resources in Native Image] guide."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:97
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:284
msgid "The final order of business is to make the configuration file known to the `native-image` executable by adding the proper configuration to `application.properties`:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:104
#, no-wrap
msgid ""
"quarkus.native.additional-build-args =\\\n"
"    -H:+UnlockExperimentalVMOptions,\\\n"
"    -H:ResourceConfigurationFiles=resources-config.json,\\\n"
"    -H:-UnlockExperimentalVMOptions\n"
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:110
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:297
msgid "Starting with Mandrel 23.1 and GraalVM for JDK 21, `-H:ResourceConfigurationFiles=resources-config.json` results in a warning being shown unless wrapped in `-H:+UnlockExperimentalVMOptions` and `-H:-UnlockExperimentalVMOptions`.  The absence of these options will result in build failures in the future."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:114
msgid "In the previous snippet we were able to simply use `resources-config.json` instead of specifying the entire path of the file simply because it was added to `src/main/resources`.  If the file had been added to another directory, the proper file path would have had to be specified manually."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:118
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:305
msgid "Multiple options may be separated by a comma. For example, one could use:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:126
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:313
#, no-wrap
msgid ""
"quarkus.native.additional-build-args =\\\n"
"    -H:+UnlockExperimentalVMOptions,\\\n"
"    -H:ResourceConfigurationFiles=resources-config.json,\\\n"
"    -H:ReflectionConfigurationFiles=reflection-config.json,\\\n"
"    -H:-UnlockExperimentalVMOptions\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:129
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:316
msgid "in order to ensure that various resources are included and additional reflection is registered."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:132
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:319
msgid "If for some reason adding the aforementioned configuration to `application.properties` is not desirable, it is possible to configure the build tool to effectively perform the same operation."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:134
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:321
msgid "When using Maven, we could use the following configuration:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:148
#, no-wrap
msgid ""
"<profiles>\n"
"    <profile>\n"
"        <id>native</id>\n"
"        <properties>\n"
"            <quarkus.package.type>native</quarkus.package.type>\n"
"            <quarkus.native.additional-build-args>\n"
"                -H:+UnlockExperimentalVMOptions,-H:ResourceConfigurationFiles=resources-config.json,-H:-UnlockExperimentalVMOptions\n"
"            </quarkus.native.additional-build-args>\n"
"        </properties>\n"
"    </profile>\n"
"</profiles>\n"
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:150
#, no-wrap
msgid "Registering for reflection"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:154
msgid "When building a native executable, GraalVM operates with a closed world assumption.  It analyzes the call tree and removes all the classes/methods/fields that are not used directly."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:157
msgid "The elements used via reflection are not part of the call tree so they are dead code eliminated (if not called directly in other cases).  To include these elements in your native executable, you need to register them for reflection explicitly."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:159
msgid "This is a very common case as JSON libraries typically use reflection to serialize the objects to JSON:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:165
#, no-wrap
msgid ""
"    public class Person {\n"
"        private String first;\n"
"        private String last;\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:169
#, no-wrap
msgid ""
"        public String getFirst() {\n"
"            return first;\n"
"        }\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:173
#, no-wrap
msgid ""
"        public void setFirst(String first) {\n"
"            this.first = first;\n"
"        }\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:177
#, no-wrap
msgid ""
"        public String getLast() {\n"
"            return last;\n"
"        }\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:182
#, no-wrap
msgid ""
"        public void setValue(String last) {\n"
"            this.last = last;\n"
"        }\n"
"    }\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:187
#, no-wrap
msgid ""
"    @Path(\"/person\")\n"
"    @Produces(MediaType.APPLICATION_JSON)\n"
"    @Consumes(MediaType.APPLICATION_JSON)\n"
"    public class PersonResource {\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:189
#, no-wrap
msgid "        private final Jsonb jsonb;\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:193
#, no-wrap
msgid ""
"        public PersonResource() {\n"
"            jsonb = JsonbBuilder.create(new JsonbConfig());\n"
"        }\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:199
#, no-wrap
msgid ""
"        @GET\n"
"        public Response list() {\n"
"            return Response.ok(jsonb.fromJson(\"{\\\"first\\\":  \\\"foo\\\", \\\"last\\\":  \\\"bar\\\"}\", Person.class)).build();\n"
"        }\n"
"    }\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:202
msgid "If we were to use the code above, we would get an exception like the following when using the native executable:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:206
#, no-wrap
msgid "Exception handling request to /person: org.jboss.resteasy.spi.UnhandledException: jakarta.json.bind.JsonbException: Can't create instance of a class: class org.acme.jsonb.Person, No default constructor found\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:209
msgid "or if you are using Jackson:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:213
#, no-wrap
msgid "com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class org.acme.jsonb.Person and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS)\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:216
msgid "An even nastier possible outcome could be for no exception to be thrown, but instead the JSON result would be completely empty."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:218
msgid "There are two different ways to fix this type of issues."
msgstr ""

#. type: Title ====
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:220
#, no-wrap
msgid "Using the @RegisterForReflection annotation"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:223
msgid "The easiest way to register a class for reflection is to use the `@RegisterForReflection` annotation:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:229
#, no-wrap
msgid ""
"@RegisterForReflection\n"
"public class MyClass {\n"
"}\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:232
msgid "If your class is in a third-party jar, you can do it by using an empty class that will host the `@RegisterForReflection` for it."
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:238
#, no-wrap
msgid ""
"@RegisterForReflection(targets={ MyClassRequiringReflection.class, MySecondClassRequiringReflection.class})\n"
"public class MyReflectionConfiguration {\n"
"}\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:241
msgid "Note that `MyClassRequiringReflection` and `MySecondClassRequiringReflection` will be registered for reflection but not `MyReflectionConfiguration`."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:243
msgid "This feature is handy when using third-party libraries using object mapping features (such as Jackson or GSON):"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:248
#, no-wrap
msgid ""
"@RegisterForReflection(targets = {User.class, UserImpl.class})\n"
"public class MyReflectionConfiguration {\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:250
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:657
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:678
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:700
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:724
#, no-wrap
msgid "}\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:255
msgid "You can also use a configuration file to register classes for reflection, if you prefer relying on the GraalVM infrastructure."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:262
msgid "As an example, in order to register all methods of class `com.acme.MyClass` for reflection, we create `reflection-config.json` (the most common location is within `src/main/resources`)"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:276
#, no-wrap
msgid ""
"[\n"
"  {\n"
"    \"name\" : \"com.acme.MyClass\",\n"
"    \"allDeclaredConstructors\" : true,\n"
"    \"allPublicConstructors\" : true,\n"
"    \"allDeclaredMethods\" : true,\n"
"    \"allPublicMethods\" : true,\n"
"    \"allDeclaredFields\" : true,\n"
"    \"allPublicFields\" : true\n"
"  }\n"
"]\n"
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:281
msgid "For more information about the format of this file, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/dynamic-features/Reflection/[GraalVM Reflection in Native Image] guide."
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:291
#, no-wrap
msgid ""
"quarkus.native.additional-build-args =\\\n"
"    -H:+UnlockExperimentalVMOptions,\\\n"
"    -H:ReflectionConfigurationFiles=reflection-config.json,\\\n"
"    -H:-UnlockExperimentalVMOptions\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:301
msgid "In the previous snippet we were able to simply use `reflection-config.json` instead of specifying the entire path of the file simply because it was added to `src/main/resources`.  If the file had been added to another directory, the proper file path would have had to be specified manually."
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:335
#, no-wrap
msgid ""
"<profiles>\n"
"    <profile>\n"
"        <id>native</id>\n"
"        <properties>\n"
"            <quarkus.package.type>native</quarkus.package.type>\n"
"            <quarkus.native.additional-build-args>\n"
"                -H:+UnlockExperimentalVMOptions,-H:ReflectionConfigurationFiles=reflection-config.json,-H:-UnlockExperimentalVMOptions\n"
"            </quarkus.native.additional-build-args>\n"
"        </properties>\n"
"    </profile>\n"
"</profiles>\n"
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:338
#, no-wrap
msgid "Delaying class initialization"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:341
msgid "By default, Quarkus initializes all classes at build time."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:344
msgid "There are cases where the initialization of certain classes is done in a static block needs to be postponed to runtime.  Typically, omitting such configuration would result in a runtime exception like the following:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:351
#, no-wrap
msgid ""
"Error: No instances are allowed in the image heap for a class that is initialized or reinitialized at image runtime: sun.security.provider.NativePRNG\n"
"Trace: object java.security.SecureRandom\n"
"method com.amazonaws.services.s3.model.CryptoConfiguration.<init>(CryptoMode)\n"
"Call path from entry point to com.amazonaws.services.s3.model.CryptoConfiguration.<init>(CryptoMode):\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:354
msgid "Another common source of errors is when the image heap taken by GraalVM contains a `Random`/`SplittableRandom` instance:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:358
#, no-wrap
msgid "Error: com.oracle.graal.pointsto.constraints.UnsupportedFeatureException: Detected an instance of Random/SplittableRandom class in the image heap. Instances created during image generation have cached seed values and don't behave as expected.\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:362
msgid "Which is more often than not caused by Quarkus initializing at build time a class with a static `Random`/`SplittableRandom` field, causing this particular instance to be tentatively included in the image heap."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:366
msgid "You can find detailed information about this `Random`/`SplittableRandom` issue in https://foivos.zakkak.net/tutorials/working-with-randoms-native-images/[this blog post]."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:370
msgid "In these cases, delaying the infringing class initialization at runtime might be the solution and, to achieve that, you can use the `--initialize-at-run-time=<package or class>` configuration knob."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:372
msgid "It should be added to the `native-image` configuration using the `quarkus.native.additional-build-args` configuration property as shown in the examples above."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:376
msgid "For more information, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/optimizations-and-performance/ClassInitialization/[GraalVM Class Initialization in Native Image] guide."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:382
msgid "When multiple classes or packages need to be specified via the `quarkus.native.additional-build-args` configuration property, the `,` symbol needs to be escaped.  An example of this is the following:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:386
#, no-wrap
msgid "quarkus.native.additional-build-args=--initialize-at-run-time=com.example.SomeClass\\\\,org.acme.SomeOtherClass\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:389
msgid "and in the case of using the Maven configuration instead of `application.properties`:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:393
#, no-wrap
msgid "<quarkus.native.additional-build-args>--initialize-at-run-time=com.example.SomeClass\\,org.acme.SomeOtherClass</quarkus.native.additional-build-args>\n"
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:396
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:709
#, no-wrap
msgid "Managing Proxy Classes"
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:399
msgid "While writing native application you'll need to define proxy classes at image build time by specifying the list of interfaces that they implement."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:401
msgid "In such a situation, the error you might encounter is:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:405
#, no-wrap
msgid "com.oracle.svm.core.jdk.UnsupportedFeatureError: Proxy class defined by interfaces [interface org.apache.http.conn.HttpClientConnectionManager, interface org.apache.http.pool.ConnPoolControl, interface com.amazonaws.http.conn.Wrapped] not found. Generating proxy classes at runtime is not supported. Proxy classes need to be defined at image build time by specifying the list of interfaces that they implement. To define proxy classes use -H:DynamicProxyConfigurationFiles=<comma-separated-config-files> and -H:DynamicProxyConfigurationResources=<comma-separated-config-resources> options.\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:408
msgid "Solving this issue requires adding the `-H:DynamicProxyConfigurationResources=<comma-separated-config-resources>` option and to provide a dynamic proxy configuration file."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:410
msgid "For more information about the format of this file, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/guides/configure-dynamic-proxies/[GraalVM Configure Dynamic Proxies Manually] guide."
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:412
#, no-wrap
msgid "Modularity Benefits"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:418
msgid "During native executable build time GraalVM analyses the application's call tree and generates a code-set that includes all the code it needs.  Having a modular codebase is key to avoiding problems with unused or optional parts of your application, while at the same time reducing both native executable build times and size.  In this section you will learn about the details behind the benefits of modularity for native applications."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:432
msgid "When code is not modular enough, generated native executables can end up with more code than what the user needs.  If a feature is not used and the code gets compiled into the native executable, this is a waste of native compilation time and memory usage, as well as native executable disk space and starting heap size.  Even more problems arise when third party libraries or specialized API subsystems are used which cause native compilation or runtime errors, and their use is not modularised enough.  A recent problem can be found in the JAXB library, which is capable of deserializing XML files containing images using Java’s AWT APIs.  The vast majority of Quarkus XML users don’t need to deserialize images, so there shouldn’t be a need for users applications to include Java AWT code, unless they specifically configure Quarkus to add the JAXB AWT code to the native executable.  However, because JAXB code that uses AWT is in the same jar as the rest of the XML parsing code, achieving this separation was rather complex and required the use of Java bytecode substitutions to get around it.  These substitutions are hard to maintain and can easily break, hence they should be one's last resort."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:437
msgid "A modular codebase is the best way to avoid these kind of issues.  Taking the JAXB/AWT problem above, if the JAXB code that dealt with images was in a separate module or jar (e.g. `jaxb-images`), then Quarkus could choose not to include that module unless the user specifically requested the need to serialize/deserialize XML files containing images at build time."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:440
msgid "Another benefit of modular applications is that they can reduce the code-set that will need to get into the native executable.  The smaller the code-set, the faster the native executable builds will be and the smaller the native executable produced."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:446
msgid "The key takeaway point here is the following: Keeping optional features, particularly those that depend on third party libraries or API subsystems with a big footprint, in separate modules is the best solution."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:455
msgid "How do I know if my application suffers from similar problems? Aside from a deep study of the application, finding usages of https://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html[Maven optional dependencies] is a clear indicator that your application might suffer from similar problems.  These type of dependencies should be avoided, and instead code that interacts with optional dependencies should be moved into separate modules."
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:457
#, no-wrap
msgid "Enforcing Singletons"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:464
msgid "As already explained in the xref:delay-class-init-in-your-app[delay class initialization] section, Quarkus marks all code to be initialized at build time by default.  This means that, unless marked otherwise, static variables will be assigned at build time, and static blocks will be executed at build time too."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:469
msgid "This can cause values in Java programs that would normally vary from one run to another, to always return a constant value.  E.g. a static field that is assigned the value of `System.currentTimeMillis()` will always return the same value when executed as a Quarkus native executable."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:472
msgid "Singletons that rely on static variable initialization will suffer similar problems.  For example, imagine you have a singleton based around static initialization along with a REST endpoint to query it:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:477
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:518
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:565
#, no-wrap
msgid ""
"@Path(\"/singletons\")\n"
"public class Singletons {\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:484
#, no-wrap
msgid ""
"    @GET\n"
"    @Path(\"/static\")\n"
"    public long withStatic() {\n"
"        return StaticSingleton.startTime();\n"
"    }\n"
"}\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:487
#, no-wrap
msgid ""
"class StaticSingleton {\n"
"    static final long START_TIME = System.currentTimeMillis();\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:492
#, no-wrap
msgid ""
"    static long startTime() {\n"
"        return START_TIME;\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:497
msgid "When the `singletons/static` endpoint is queried, it will always return the same value, even after the application is restarted:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:502
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:505
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:510
#, no-wrap
msgid ""
"$ curl http://localhost:8080/singletons/static\n"
"1656509254532%\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:507
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:554
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:600
#, no-wrap
msgid "### Restart the native application ###\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:513
msgid "Singletons that rely on `enum` classes are also affected by the same issue:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:525
#, no-wrap
msgid ""
"    @GET\n"
"    @Path(\"/enum\")\n"
"    public long withEnum() {\n"
"        return EnumSingleton.INSTANCE.startTime();\n"
"    }\n"
"}\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:528
#, no-wrap
msgid ""
"enum EnumSingleton {\n"
"    INSTANCE(System.currentTimeMillis());\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:530
#, no-wrap
msgid "    private final long startTime;\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:534
#, no-wrap
msgid ""
"    private EnumSingleton(long startTime) {\n"
"        this.startTime = startTime;\n"
"    }\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:539
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:585
#, no-wrap
msgid ""
"    long startTime() {\n"
"        return startTime;\n"
"    }\n"
"}\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:544
msgid "When the `singletons/enum` endpoint is queried, it will always return the same value, even after the application is restarted:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:549
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:552
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:557
#, no-wrap
msgid ""
"$ curl http://localhost:8080/singletons/enum\n"
"1656509254601%\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:560
msgid "One way to fix it is to build singletons using CDI's `@Singleton` annotation:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:568
#, no-wrap
msgid ""
"    @Inject\n"
"    CdiSingleton cdiSingleton;\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:575
#, no-wrap
msgid ""
"    @GET\n"
"    @Path(\"/cdi\")\n"
"    public long withCdi() {\n"
"        return cdiSingleton.startTime();\n"
"    }\n"
"}\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:580
#, no-wrap
msgid ""
"@Singleton\n"
"class CdiSingleton {\n"
"    // Note that the field is not static\n"
"    final long startTime = System.currentTimeMillis();\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:590
msgid "After each restart, querying `singletons/cdi` will return a different value, just like it would in JVM mode:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:595
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:598
#, no-wrap
msgid ""
"$ curl http://localhost:8080/singletons/cdi\n"
"1656510218554%\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:603
#, no-wrap
msgid ""
"$ curl http://localhost:8080/singletons/cdi\n"
"1656510714689%\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:610
msgid "An alternative way to enforce a singleton while relying static fields, or enums, is to xref:delay-class-init-in-your-app[delay its class initialization until run time].  The nice advantage of CDI-based singletons is that your class initialization is not constrained, so you can freely decide whether it should be build-time or run-time initialized, depending on your use case."
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:611
#, no-wrap
msgid "Beware of common Java API overrides"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:621
msgid "Certain commonly used Java methods are overriden by user classes, e.g. `toString`, `equals`, `hashCode`...etc.  The majority of overrides do not cause problems, but if they use third party libraries (e.g. for additional formatting), or use dynamic language features (e.g. reflection or proxies), they can cause native image build to fail.  Some of those failures might be solvable via configuration, but others can be more tricky to handle."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:629
msgid "From a GraalVM points-to analysis perspective, what happens in these method overrides matters, even if the application does not explicitly call them.  This is because these methods are used throughout the JDK, and all it takes is for one of those calls to be done on an unconstrained type, e.g. `java.lang.Object`, for the analysis to have to pull all implementations of that particular method."
msgstr ""

#. type: Title ==
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:631
#, no-wrap
msgid "Supporting native in a Quarkus extension"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:634
msgid "Supporting native in a Quarkus extension is even easier as Quarkus provides a lot of tools to simplify all this."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:638
msgid "Everything described here will only work in the context of Quarkus extensions, it won't work in an application."
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:640
#, no-wrap
msgid "Register reflection"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:643
msgid "Quarkus makes registration of reflection in an extension a breeze by using `ReflectiveClassBuildItem`, thus eliminating the need for a JSON configuration file."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:645
msgid "To register a class for reflection, one would need to create a Quarkus processor class and add a build step that registers reflection:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:649
#, no-wrap
msgid "public class SaxParserProcessor {\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:655
#, no-wrap
msgid ""
"    @BuildStep\n"
"    ReflectiveClassBuildItem reflection() {\n"
"        // since we only need reflection to the constructor of the class, we can specify `false` for both the methods and the fields arguments.\n"
"        return new ReflectiveClassBuildItem(false, false, \"com.sun.org.apache.xerces.internal.parsers.SAXParser\");\n"
"    }\n"
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:662
msgid "For more information about reflection in GraalVM, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/dynamic-features/Reflection/[GraalVM Reflection in Native Image] guide."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:667
msgid "In the context of an extension, Quarkus eliminates the need for a JSON configuration file by allowing extension authors to specify a `NativeImageResourceBuildItem`:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:671
#, no-wrap
msgid "public class ResourcesProcessor {\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:676
#, no-wrap
msgid ""
"    @BuildStep\n"
"    NativeImageResourceBuildItem nativeImageResourceBuildItem() {\n"
"        return new NativeImageResourceBuildItem(\"META-INF/extra.properties\");\n"
"    }\n"
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:683
msgid "For more information about GraalVM resource handling in native executables, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/dynamic-features/Resources/[GraalVM Accessing Resources in Native Image] guide."
msgstr ""

#. type: Title ==
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:686
#, no-wrap
msgid "Delay class initialization"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:689
msgid "Quarkus simplifies things by allowing extensions authors to simply register a `RuntimeInitializedClassBuildItem`. A simple example of doing so could be:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:693
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:716
#, no-wrap
msgid "public class S3Processor {\n"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:698
#, no-wrap
msgid ""
"    @BuildStep\n"
"    RuntimeInitializedClassBuildItem cryptoConfiguration() {\n"
"        return new RuntimeInitializedClassBuildItem(CryptoConfiguration.class.getCanonicalName());\n"
"    }\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:703
msgid "Using such a construct means that a `--initialize-at-run-time` option will automatically be added to the `native-image` command line."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:707
msgid "For more information about the `--initialize-at-run-time` option, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/optimizations-and-performance/ClassInitialization/[GraalVM Class Initialization in Native Image] guide."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:712
msgid "Very similarly, Quarkus allows extensions authors to register a `NativeImageProxyDefinitionBuildItem`. An example of doing so is:"
msgstr ""

#. type: delimited block -
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:722
#, no-wrap
msgid ""
"    @BuildStep\n"
"    NativeImageProxyDefinitionBuildItem httpProxies() {\n"
"        return new NativeImageProxyDefinitionBuildItem(\"org.apache.http.conn.HttpClientConnectionManager\",\n"
"                \"org.apache.http.pool.ConnPoolControl\", \"com.amazonaws.http.conn.Wrapped\");\n"
"    }\n"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:727
msgid "Using such a construct means that a `-H:DynamicProxyConfigurationResources` option will automatically be added to the `native-image` command line."
msgstr ""

#. type: delimited block =
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:731
msgid "For more information about Proxy Classes, see the link:https://www.graalvm.org/{graalvm-docs-version}/reference-manual/native-image/guides/configure-dynamic-proxies/[GraalVM Configure Dynamic Proxies Manually] guide."
msgstr ""

#. type: Title ===
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:733
#, no-wrap
msgid "Logging with Native Image"
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:736
msgid "If you are using dependencies that require logging components such as Apache Commons Logging or Log4j and are experiencing a `ClassNotFoundException` when building the native executable, you can resolve this by excluding the logging library and adding the corresponding JBoss Logging adapter."
msgstr ""

#. type: Plain text
#: upstream/_versions/main/guides/writing-native-applications-tips.adoc:737
msgid "For more details please refer to the xref:logging.adoc#logging-adapters[Logging guide]."
msgstr ""
