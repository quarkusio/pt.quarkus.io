# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"POT-Creation-Date: 2023-09-21 08:08+0900\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: pt_BR\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. type: Title =
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "MEF and Sofis use Quarkus as core component of a new innovative architecture"
msgstr "A MEF e a Sofis utilizam o Quarkus como componente central de uma nova arquitetura inovadora"

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "About us"
msgstr "Sobre nós"

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"The Ministry of Economy and Finance (MEF) of Uruguay is a government ministry. +\n"
"Website: https://www.gub.uy/ministerio-economia-finanzas"
msgstr ""
"O Ministério da Economia e Finanças (MEF) do Uruguai é um ministério do governo.\n"
"\n"
" Site: https://www.gub.uy/ministerio-economia-finanzas"

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"Sofis Solutions is a company with more than 18 years of experience in the digital transformation of Latin American organizations and technological inclusion. Focuses mainly on projects for the development of digital government and the resolution of social, environmental and governance problems. +\n"
"Website: https://www.sofis.lat"
msgstr ""
"A Sofis Solutions é uma empresa com mais de 18 anos de experiência na transformação digital de organizações latino-americanas e na inclusão tecnológica. Concentra-se principalmente em projetos para o desenvolvimento de governos digitais e na resolução de problemas sociais, ambientais e de governança.\n"
"\n"
" Site: https://www.sofis.lat"

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Problem statement"
msgstr "Declaração do problema"

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"The current Integrated Financial Information System (SIIF) of the Uruguayan Ministry of Economy and Finance relies on Oracle Forms, which presents certain drawbacks such as limited compatibility, inflexibility, high maintenance costs, and limited support. To ensure long-term viability and modernization, an architecture update is needed. The main objective is to establish a scalable reference architecture that enables SIIF to evolve as part of the modernization process.\n"
"In late 2021 an architecture team was formed, and work began following the https://pubs.opengroup.org/architecture/togaf92-doc/arch/[TOGAF Architecture Development Method 9.2]."
msgstr "O atual Sistema Integrado de Informações Financeiras (SIIF) do Ministério da Economia e Finanças do Uruguai depende do Oracle Forms, que apresenta algumas desvantagens, como compatibilidade limitada, inflexibilidade, altos custos de manutenção e suporte limitado. Para garantir a viabilidade e a modernização a longo prazo, é necessária uma atualização da arquitetura. O principal objetivo é estabelecer uma arquitetura de referência escalável que permita ao SIIF evoluir como parte do processo de modernização. No final de 2021, foi formada uma equipe de arquitetura e o trabalho começou a seguir o link:https://pubs.opengroup.org/architecture/togaf92-doc/arch/[Método de Desenvolvimento de Arquitetura TOGAF 9.2] ."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Key requirements"
msgstr "Requisitos essenciais"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The key requirements of this modernized architecture were:"
msgstr "Os principais requisitos desta arquitetura modernizada eram:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "It must be possible to audit transactions and changes made to entities."
msgstr "Deve ser possível auditar as transacções e as alterações efectuadas nas entidades."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "During runtime, software systems should generate metrics that provide visibility into the operational status of each component. These metrics should be accessible through a centralized monitoring platform, which should enable the visualization of the current status and generation of alerts."
msgstr "Durante o tempo de execução, os sistemas de software devem gerar métricas que proporcionem visibilidade sobre o estado operacional de cada componente. Estas métricas devem ser acessíveis através de uma plataforma de monitorização centralizada, que deve permitir a visualização do estado atual e a geração de alertas."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Under normal production conditions, the system must respond with a latency of less than one second."
msgstr "Em condições normais de produção, o sistema deve responder com uma latência inferior a um segundo."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "A monthly availability of the solution of 99% is required within office hours and 95% outside of office hours."
msgstr "É exigida uma disponibilidade mensal da solução de 99% dentro do horário de expediente e de 95% fora do horário de expediente."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Systems should be able to handle an increasing workload, such as the addition of new user groups, higher volumes of traffic, or more complex transactions, by utilizing horizontal scaling techniques. Services must be deployed as Docker containers."
msgstr "Os sistemas devem ser capazes de lidar com uma carga de trabalho crescente, como a adição de novos grupos de utilizadores, maiores volumes de tráfego ou transacções mais complexas, utilizando técnicas de escalonamento horizontal. Os serviços devem ser implantados como contentores Docker."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Communication between systems using REST (preferred) and SOAP (legacy) protocols must be supported."
msgstr "Deve ser suportada a comunicação entre sistemas utilizando os protocolos REST (preferencial) e SOAP (antigo)."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Software must be able to be tested on a unitary, integration and system-wide basis."
msgstr "O software deve poder ser testado numa base unitária, de integração e de todo o sistema."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The central data repository of the transactional system must maintain permanent data integrity and consistency. This consistency must be ensured despite technical failures or crashes of other components."
msgstr "O repositório central de dados do sistema transacional deve manter a integridade e a coerência permanentes dos dados. Esta consistência deve ser assegurada apesar de falhas técnicas ou avarias de outros componentes."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "All the log data and exceptions must be properly captured and centrally managed."
msgstr "Todos os dados de registo e excepções devem ser devidamente capturados e geridos de forma centralizada."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Software that is being developed should be highly configurable to ensure it can be deployed across various installation environments, such as development, testing, pre-production, production, etc. without the need for recompiling it for each environment."
msgstr "O software que está a ser desenvolvido deve ser altamente configurável para garantir que pode ser implementado em vários ambientes de instalação, tais como desenvolvimento, teste, pré-produção, produção, etc., sem necessidade de o recompilar para cada ambiente."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Components should easily integrate with distributed event streaming platforms as Kafka."
msgstr "Os componentes devem integrar-se facilmente com plataformas de transmissão de eventos distribuídos como o Kafka."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Framework utilized must enhance developer experience. Live reload while coding is highly valuable."
msgstr "A estrutura utilizada deve melhorar a experiência do programador. O recarregamento em tempo real durante a codificação é extremamente valioso."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Coding must be aligned with Java EE and MicroProfile ecosystems."
msgstr "A codificação deve estar alinhada com os ecossistemas Java EE e MicroProfile."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Components must provide a mechanism that allows health monitoring through the health monitor of the platform."
msgstr "Os componentes devem fornecer um mecanismo que permita o controlo do estado de saúde através do monitor de saúde da plataforma."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We selected Quarkus as the framework for our backends based on its ability to fulfill all our critical requirements. Its extensive features, capabilities, and active community were precisely what we were looking for, making it an essential tool for our projects."
msgstr "Seleccionámos o Quarkus como a estrutura para os nossos backends com base na sua capacidade de cumprir todos os nossos requisitos críticos. As suas extensas funcionalidades, capacidades e comunidade ativa eram precisamente o que procurávamos, tornando-o uma ferramenta essencial para os nossos projectos."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, no-wrap
msgid "Architecture"
msgstr "Arquitetura"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The architecture diagrams are made following the https://c4model.com/[C4 model]. Systems are composed of modules implemented using a macroservices approach that are larger than microservices but smaller than monolithic applications. A simplified version of the system landscape is presented below:"
msgstr "Os diagramas de arquitetura são elaborados segundo o  link:https://c4model.com/[modelo C4]. Os sistemas são compostos por módulos implementados através de uma abordagem de macrosserviços que são maiores do que os microsserviços mas mais pequenos do que as aplicações monolíticas. Apresenta-se de seguida uma versão simplificada da paisagem do sistema:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Description:"
msgstr "Descrição:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "System 1 to N. Can be any of the systems used in MEF."
msgstr "Sistema 1 a N. Pode ser qualquer um dos sistemas utilizados no MEF."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Security system. Management of users, roles, operations, audit logs, etc."
msgstr "Sistema de segurança. Gestão de utilizadores, funções, operações, registos de auditoria, etc."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "https://mi.iduruguay.gub.uy/[ID Uruguay]. AGESIC Identity and Authentication Provider. Users must start an OAuth2 authentication flow against this provider via MEF applications."
msgstr "link:https://mi.iduruguay.gub.uy/[ID Uruguai]. Fornecedor de Identidade e Autenticação AGESIC. Os utilizadores devem iniciar um fluxo de autenticação OAuth2 contra este fornecedor através de aplicações MEF."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "External system. Represents an external system that consumes MEF APIs."
msgstr "Sistema externo. Representa um sistema externo que consome APIs MEF."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "In addition to the internal systems, some of the most relevant tools we use are:"
msgstr "Para além dos sistemas internos, algumas das ferramentas mais relevantes que utilizamos são:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Kubernetes. Container orchestrator."
msgstr "Kubernetes. Orquestrador de contentores."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Ceph. Storage platform."
msgstr "Ceph. Plataforma de armazenamento."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Elasticsearch, Fluentd, Kibana stack. Storage and visualization of log and audit data."
msgstr "Pilha Elasticsearch, Fluentd e Kibana. Armazenamento e visualização de dados de registo e auditoria."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Prometheus, Alertmanager, Grafana stack. Visualization of infrastructure and services metrics. Also responsible for generating alerts."
msgstr "Prometheus, Alertmanager, pilha Grafana. Visualização de métricas de infraestrutura e serviços. Responsável também pela geração de alertas."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Matomo. Used to obtain user analytics and their behavior on websites."
msgstr "Matomo. Utilizado para obter análises de utilizadores e o seu comportamento nos sítios Web."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Apache Kafka. Distributed event streaming platform."
msgstr "Apache Kafka. Plataforma de transmissão de eventos distribuídos."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Apache APISIX API Gateway. Manage and expose APIs."
msgstr "Apache APISIX API Gateway. Gerir e expor APIs."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "ArgoCD. GitOps continuous delivery tool."
msgstr "ArgoCD. Ferramenta de entrega contínua GitOps."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "GitLab. Code repository and CI/CD DevOps tool."
msgstr "GitLab. Repositório de código e ferramenta DevOps CI/CD."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Nexus. Repository for libraries and Docker images."
msgstr "Nexus. Repositório de bibliotecas e imagens Docker."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "SonarQube. Static code analysis tool."
msgstr "SonarQube. Ferramenta de análise de código estático."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, no-wrap
msgid "Kubernetes"
msgstr "Kubernetes"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Kubernetes is an open-source container orchestration system for automating software deployment, scaling, and management. The combination of Quarkus and Kubernetes provides an ideal environment for creating scalable, fast, and lightweight applications. Our applications and tools are deployed in two on-premise Kubernetes clusters for production and non-production environments."
msgstr "O Kubernetes é um sistema de orquestração de contentores de código aberto para automatizar a implementação, o dimensionamento e a gestão de software. A combinação de Quarkus e Kubernetes proporciona um ambiente ideal para criar aplicações escaláveis, rápidas e leves. As nossas aplicações e ferramentas são implementadas em dois clusters Kubernetes no local para ambientes de produção e de não produção."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "ArgoCD and Kustomize"
msgstr "ArgoCD e Kustomize"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "ArgoCD is a Kubernetes operator that utilizes CRDs (Custom Resource Definitions) to configure its operation. These CRDs enable the definition of infrastructure through Git-stored files and automate deployment following any changes made."
msgstr "O ArgoCD é um operador Kubernetes que utiliza CRDs (Custom Resource Definitions) para configurar seu funcionamento. Estas CRDs permitem a definição da infraestrutura através de ficheiros armazenados em Git e automatizam a implementação após quaisquer alterações efectuadas."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Kustomize adheres to Kubernetes principles by leveraging Kubernetes objects to define configuration files and manage these configurations declaratively. A Kustomization object defines how to generate or transform other Kubernetes objects and is created in a file named kustomization.yaml, which can be edited by Kustomize itself. Kustomizations can be patched with overlays to overwrite base settings and create variants. ArgoCD offers seamless Kustomize support, allowing for more efficient and effective management of Kubernetes configurations."
msgstr "O Kustomize adere aos princípios do Kubernetes, aproveitando os objetos do Kubernetes para definir arquivos de configuração e gerenciar essas configurações de forma declarativa. Um objeto Kustomization define como gerar ou transformar outros objetos Kubernetes e é criado em um arquivo chamado kustomization.yaml, que pode ser editado pelo próprio Kustomize. As Kustomizações podem ser corrigidas com sobreposições para substituir as configurações básicas e criar variantes. O ArgoCD oferece suporte contínuo ao Kustomize, permitindo o gerenciamento mais eficiente e eficaz das configurações do Kubernetes."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Ceph"
msgstr "Ceph"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Ceph is an open source software-defined storage platform that implements object storage on a single distributed computer cluster and provides 3-in-1 interfaces for object, block and file level storage. We have two on-premise clusters (prod and non-prod) that are integrated with our Kubernetes clusters."
msgstr "O Ceph é uma plataforma de armazenamento definido por software de código aberto que implementa o armazenamento de objectos num único cluster de computadores distribuídos e fornece interfaces 3 em 1 para armazenamento ao nível de objectos, blocos e ficheiros. Temos dois clusters locais (prod e não prod) que estão integrados nos nossos clusters Kubernetes."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "CI/CD"
msgstr "CI/CD"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We are currently using a customized CI/CD flow based primarily on https://nvie.com/posts/a-successful-git-branching-model/[A successful Git branching model]. All the CI/CD tasks are implemented using GitLab."
msgstr "Atualmente, estamos a utilizar um fluxo de CI/CD personalizado baseado principalmente num  link:https://nvie.com/posts/a-successful-git-branching-model/[modelo de ramificação bem sucedido do Git]. Todas as tarefas de CI/CD são implementadas usando o GitLab."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We follow the \"build once deploy anywhere\" approach whenever possible. The code is built using s2i (source to image) and the images are propagated through the different environments (development, integration, test/QA, training, preprod and production)."
msgstr "Seguimos a abordagem \"construir uma vez, implementar em qualquer lugar\" sempre que possível. O código é construído utilizando s2i (source to image) e as imagens são propagadas através dos diferentes ambientes (desenvolvimento, integração, teste/QA, formação, pré-produção e produção)."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Our type of development requires us to have 3 unique long lived branches per project:"
msgstr "O nosso tipo de desenvolvimento exige que tenhamos 3 ramos únicos de longa duração por projeto:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Main. Where all the developers continuously merge their new features."
msgstr "Principal. Onde todos os programadores fundem continuamente as suas novas funcionalidades."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Release. When the code in main is ready to be released to QA, it is merged to the release branch. Release can be evolved independently of main while bugfixes are applied."
msgstr "Lançamento. Quando o código no main está pronto para ser lançado para QA, é fundido com o ramo de lançamento. O release pode ser evoluído independentemente do main enquanto as correcções de erros são aplicadas."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Production. Where the code released to production is. Hotfixes branches are created from it."
msgstr "Produção. Onde está o código lançado para produção. As ramificações de hotfixes são criadas a partir dele."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Metrics"
msgstr "Métricas"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The Prometheus-Grafana combination has become one of the most popular solutions for monitoring, alerting, and visualization in the cloud-native space. Prometheus is an open source systems monitoring and alerting toolkit. Grafana is a multi-platform open source analytics and interactive visualization web application. It provides out of the box support to display data collected by Prometheus."
msgstr "A combinação Prometheus-Grafana se tornou uma das soluções mais populares para monitoramento, alerta e visualização no espaço nativo da nuvem. O Prometheus é um kit de ferramentas de monitoramento e alerta de sistemas de código aberto. Grafana é um aplicativo da Web de visualização interativa e análise de código aberto multiplataforma. Ele fornece suporte pronto para uso para exibir dados coletados pelo Prometheus."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "With them, we can gather, visualize and react to metrics from Kubernetes, CephFS, Apache APISIX, Elasticsearch, Kafka, Zookeeper, databases, backends, frontends and more."
msgstr "Com eles, podemos reunir, visualizar e reagir a métricas do Kubernetes, CephFS, Apache APISIX, Elasticsearch, Kafka, Zookeeper, bancos de dados, back-ends, front-ends e muito mais."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "To start exposing metrics with Quarkus, the `quarkus-micrometer-registry-prometheus` extension must be added. This allows us to get interesting metrics about our application as CPU, heap, non heap, http requests, etc. With the default HTTP metrics exposed, we are able to get the following insights by method:"
msgstr "Para começar a expor métricas com o Quarkus, a extensão `quarkus-micrometer-registry-prometheus` deve ser adicionada. Isto permite-nos obter métricas interessantes sobre a nossa aplicação como CPU, heap, non heap, pedidos http, etc. Com as métricas HTTP padrão expostas, podemos obter as seguintes informações por método:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Total number of requests"
msgstr "Número total de pedidos"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Maximum request duration"
msgstr "Duração máxima do pedido"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Average request duration"
msgstr "Duração média do pedido"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Sum of the duration of every request"
msgstr "Soma da duração de cada pedido"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "To determine whether the maximum request duration is an isolated case or is occurring on many requests, percentiles must be used."
msgstr "Para determinar se a duração máxima do pedido é um caso isolado ou se está a ocorrer em muitos pedidos, devem ser utilizados percentis."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Percentiles"
msgstr "Percentis"

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"A percentile is a measure used in statistics indicating the value below which a given percentage of observations in a group of observations fall. For example, the response time for a HTTP request below which 90% of the response time values lie, is called the 90-percentile response time.\n"
"The recommended way to calculate percentiles is using the \"Percentiles Histogram\" approach. See https://micrometer.io/docs/concepts#_histograms_and_percentiles.\n"
"Quarkus (and Micrometer) let you enable this kind of metric by defining a `@Singleton` MeterFilterProducer. Example code below:"
msgstr "Um percentil é uma medida usada em estatística que indica o valor abaixo do qual uma determinada porcentagem de observações em um grupo de observações se enquadra. Por exemplo, o tempo de resposta de uma solicitação HTTP, abaixo do qual se encontram 90% dos valores de tempo de resposta, é chamado de tempo de resposta de percentil 90. A maneira recomendada de calcular percentis é usar a abordagem \"Histograma de percentis\". link:https://micrometer.io/docs/concepts#_histograms_and_percentiles[Consulte https://micrometer.io/docs/concepts#_histograms_and_percentiles.] O Quarkus (e o Micrometer) permitem que o senhor habilite esse tipo de métrica definindo um `@Singleton` MeterFilterProducer. Exemplo de código abaixo:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "With this new exposed metrics we can define, for example:"
msgstr "Com esta nova métrica exposta, podemos definir, por exemplo:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "An alert in Prometheus that will fire when the 95 percentile request duration time is above 300ms."
msgstr "Um alerta no Prometheus que será disparado quando o tempo de duração do pedido no percentil 95 for superior a 300ms."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "An interactive chart in Grafana to display some desired percentiles as 50, 75, 90, 95, 99 and 1:"
msgstr "Um gráfico interativo no Grafana para exibir alguns percentis desejados como 50, 75, 90, 95, 99 e 1:"

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Authentication and authorization"
msgstr "Autenticação e autorização"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Our API security is implemented with Json Web Tokens. We have a centralized auth service that generates JWT, which are used by users and applications to consume the exposed APIs. Every backend has access to the public key and can validate the signature on their own. For protecting the endpoints, the `@RolesAllowed` annotation is being used. In addition to that, the `quarkus-security` extension must be added."
msgstr "A segurança da nossa API é implementada com Json Web Tokens. Temos um serviço de autenticação centralizado que gera JWT, que são utilizados por utilizadores e aplicações para consumir as APIs expostas. Cada backend tem acesso à chave pública e pode validar a assinatura por conta própria. Para proteger os pontos de extremidade, está a ser utilizada a anotação `@RolesAllowed`. Para além disso, a extensão `quarkus-security` deve ser adicionada."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "You may already be familiar with the \"groups\" attribute in JSON Web Tokens (JWTs), which typically maps to the `@RolesAllowed` property in many jwt-security validation libraries. However, this approach assumes that roles need to be hardcoded, which may not always be suitable. In our case, we wanted the security on the endpoints to be operation-oriented, so that a user can have dynamic roles, with different operations. To accomplish this:"
msgstr "Poderá já estar familiarizado com o atributo \"groups\" nos JWTs (JSON Web Tokens), que normalmente mapeia para a propriedade `@RolesAllowed` em muitas bibliotecas de validação jwt-security. No entanto, essa abordagem pressupõe que as funções precisam ser codificadas, o que pode nem sempre ser adequado. No nosso caso, queríamos que a segurança nos pontos de extremidade fosse orientada para a operação, para que um utilizador pudesse ter funções dinâmicas, com operações diferentes. Para isso:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Each endpoint must be mapped to a single operation."
msgstr "Cada ponto final deve ser mapeado para uma única operação."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "A way to map between JWT groups and operations is needed. Storing operations in the groups attribute of a JWT is not ideal, as the array could be significant, resulting in a large token."
msgstr "É necessária uma forma de mapear entre grupos e operações JWT. O armazenamento de operações no atributo groups de um JWT não é ideal, uma vez que a matriz pode ser significativa, resultando num token grande."

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"We decided to implement the JWT validation using a `ContainerRequestFilter`, as exposed in https://quarkus.io/guides/security-customization#jaxrs-security-context. In that filter the JWT groups are obtained and a cached method with `@CacheResult` is invoked to obtain the related operations.\n"
"As of today, we are using a memory cache with Caffeine for simplicity, but the new Redis as cache backend introduced in Quarkus 3 seems to be a good alternative, as we would be able to share the cache between all the instances. See https://quarkus.io/version/main/guides/cache-redis-reference."
msgstr "Decidimos implementar a validação do JWT usando um filtro `ContainerRequestFilter` , conforme exposto em link:https://quarkus.io/guides/security-customization#jaxrs-security-context[https://quarkus.io/guides/security-customization#jaxrs-security-context.] Nesse filtro, os grupos JWT são obtidos e um método em cache com `@CacheResult` é invocado para obter as operações relacionadas. Até o momento, estamos usando um cache de memória com o Caffeine por simplicidade, mas o novo Redis como backend de cache introduzido no Quarkus 3 parece ser uma boa alternativa, pois poderíamos compartilhar o cache entre todas as instâncias. Consulte link:https://quarkus.io/version/main/guides/cache-redis-reference[https://quarkus.io/version/main/guides/cache-redis-reference.]"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The `SecurityContext` `isUserInRole` method is overrided as:"
msgstr "O método `SecurityContext` `isUserInRole` é substituído por:"

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Audit requests"
msgstr "Pedidos de auditoria"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "A common requirement is to audit the requests that are made to our APIs. It was decided to:"
msgstr "Um requisito comum é a auditoria dos pedidos efectuados às nossas API. Foi decidido:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Store it as data streams in Elasticsearch."
msgstr "Armazene-o como fluxos de dados no Elasticsearch."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Store it asynchronously, without interfering with the request."
msgstr "Armazena-o de forma assíncrona, sem interferir com o pedido."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Always audit POST, PUT, PATCH, and DELETE methods. In a few special cases also GET methods."
msgstr "Auditar sempre os métodos POST, PUT, PATCH e DELETE. Em alguns casos especiais, também os métodos GET."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We wanted to audit params like service, requestDate, responseDate, method, baseUri, path, queryParams, userId, ip, traceId, traceApplicationChain, responseStatus, requestBody (optional) and responseBody (optional)."
msgstr "Queríamos auditar parâmetros como service, requestDate, responseDate, method, baseUri, path, queryParams, userId, ip, traceId, traceApplicationChain, responseStatus, requestBody (opcional) e responseBody (opcional)."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "For doing so, we implemented some utility classes:"
msgstr "Para o efeito, implementámos algumas classes utilitárias:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "A `ContainerRequestFilter`, to get some params such as request start date and propagate them through `ContainerRequestContext`."
msgstr "A `ContainerRequestFilter`, para obter alguns parâmetros, como a data de início do pedido, e propagá-los através de `ContainerRequestContext`."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "A `ContainerResponseFilter`, to get the rest of the params and invoke a method in charge of sending an audit event to a Kafka topic. We decided to send the event only in the response filter for performance reasons, assuming that there can be minimal loss if it is not invoked."
msgstr "A `ContainerResponseFilter`, para obter o resto dos parâmetros e invocar um método encarregado de enviar um evento de auditoria para um tópico Kafka. Decidimos enviar o evento apenas no filtro de resposta por razões de desempenho, assumindo que pode haver uma perda mínima se não for invocado."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "An `@AuditedEndpoint` annotation, used to identify and customize the methods that we want to audit. The API methods not annotated, are ignored by the filter. This annotation has two boolean parameters that can be customized at method level: `auditRequestBody` (true by default) and `auditResponseBody` (false by default)."
msgstr "Uma anotação `@AuditedEndpoint`, utilizada para identificar e personalizar os métodos que pretendemos auditar. Os métodos da API não anotados são ignorados pelo filtro. Esta anotação tem dois parâmetros booleanos que podem ser personalizados ao nível do método: `auditRequestBody` (verdadeiro por predefinição) e `auditResponseBody` (falso por predefinição)."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Sending an imperative event to Kafka can be done with an Emitter (see https://quarkus.io/guides/kafka#sending-messages-with-emitter). The `quarkus-smallrye-reactive-messaging-kafka` extension has to be added."
msgstr "O envio de um evento imperativo para o Kafka pode ser efectuado com um Emitter (  https://quarkus.io/guides/kafka#sending-messages-with-emitter . A extensão `quarkus-smallrye-reactive-messaging-kafka` tem de ser adicionada."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "After we have the events in the topic, we need a way to process and store them in Elasticsearch. To perform this task, we are using the Elasticsearch Service Sink Connector deployed within Kafka Connect. Kafka Connect is a tool for scalably and reliably streaming data between Apache Kafka and other data systems. It makes it simple to quickly define connectors that move large data sets in and out of Kafka. See https://docs.confluent.io/platform/current/connect/index.html."
msgstr "Depois de termos os eventos no tópico, precisamos de uma forma de os processar e armazenar no Elasticsearch. Para executar esta tarefa, estamos a utilizar o Elasticsearch Service Sink Connector implementado no Kafka Connect. O Kafka Connect é uma ferramenta para transmitir dados de forma escalonável e confiável entre o Apache Kafka e outros sistemas de dados. Ele simplifica a definição rápida de conectores que movem grandes conjuntos de dados para dentro e para fora do Kafka. Consulte  https://docs.confluent.io/platform/current/connect/index.html"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "In addition, we are also employing Hibernate Envers for entity-oriented auditing."
msgstr "Além disso, estamos também a utilizar o Hibernate Envers para a auditoria orientada para a entidade."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Besides audit event processing, Kafka will be used as a mechanism for communication between services (and systems) that have independent databases."
msgstr "Para além do processamento de eventos de auditoria, o Kafka será utilizado como um mecanismo de comunicação entre serviços (e sistemas) que possuem bases de dados independentes."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Database schemas and migrations"
msgstr "Esquemas e migrações de bases de dados"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We have several environments e.g. development, integration, test/QA, training, preprod and production.  It is necessary to automate the execution of the scripts as the services are deployed in the different environments. Flyway is a great tool to achieve that. It allows you to:"
msgstr "Temos vários ambientes, por exemplo, desenvolvimento, integração, teste/QA, formação, pré-produção e produção. É necessário automatizar a execução dos scripts à medida que os serviços são implementados nos diferentes ambientes. O Flyway é uma excelente ferramenta para o conseguir. Permite-lhe:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Recreate a database from scratch."
msgstr "Recriar uma base de dados a partir do zero."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Make it clear at all times what state a database is in."
msgstr "Tornar sempre claro em que estado se encontra uma base de dados."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Migrate in a deterministic way from your current version of the database to a newer one."
msgstr "Migrar de forma determinística da sua versão atual da base de dados para uma mais recente."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The `quarkus-flyway` extension is needed. When running tests, or deploying the service, the migration functionality will kick in to apply the necessary scripts."
msgstr "A extensão `quarkus-flyway` é necessária. Ao executar testes ou implantar o serviço, a funcionalidade de migração entrará em ação para aplicar os scripts necessários."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Our custom case (1)"
msgstr "A nossa mala personalizada (1)"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Our system types require having groups of services sharing a single database (see https://microservices.io/patterns/data/shared-database.html). Additionaly, in some cases, legacy databases exist. Recreating the full structure from scratch with new migrations is a difficult task."
msgstr "Os nossos tipos de sistemas requerem a existência de grupos de serviços que partilham uma única base de dados (ver  https://microservices.io/patterns/data/shared-database.html . Além disso, em alguns casos, existem bases de dados antigas. Recriar a estrutura completa a partir do zero com novas migrações é uma tarefa difícil."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Decisions and implications:"
msgstr "Decisões e implicações:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "For legacy databases, a Flyway \"baseline\" should be created with the current state, and migrations applied after that point."
msgstr "Para bases de dados antigas, deve ser criada uma \"linha de base\" Flyway com o estado atual e as migrações aplicadas após esse ponto."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Each service has its own schema in the database and is responsible for its evolution. A `flyway_schema_history` table by schema is needed."
msgstr "Cada serviço tem o seu próprio esquema na base de dados e é responsável pela sua evolução. É necessária uma tabela `flyway_schema_history` por esquema."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "In certain cases, a table in schema A can have a foreign key to schema B. Therefore, one service may need structures from another in order to run correctly. This enforces that the service owner of schema B must be released before the owner of schema A. As a common rule, we avoid if possible having bidirectional foreign keys between A and B."
msgstr "Em certos casos, uma tabela no esquema A pode ter uma chave externa para o esquema B. Por conseguinte, um serviço pode necessitar de estruturas de outro para funcionar corretamente. Isto obriga a que o proprietário do serviço do esquema B seja libertado antes do proprietário do esquema A. Como regra comum, evita-se, se possível, ter chaves estrangeiras bidireccionais entre A e B."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Automated tests must run against an existing database with all the structures. A single backend cannot re-create the entire database. See <<Automatic testing / Code analysis>>."
msgstr "Os testes automatizados devem ser executados numa base de dados existente com todas as estruturas. Um único backend não pode recriar toda a base de dados. Ver  link:#Automatic testing / Code analysis[[Testes automáticos / Análise de código]]."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Note that when working with some databases like Oracle or MySQL, failed DDL migrations are not automatically rolled back. See https://flywaydb.org/documentation/learnmore/faq#rollback. We found two ways of mitigating this situation:"
msgstr "Note que, ao trabalhar com algumas bases de dados como Oracle ou MySQL, as migrações DDL falhadas não são automaticamente revertidas. Consulte  https://flywaydb.org/documentation/learnmore/faq#rollback  Encontrámos duas formas de mitigar esta situação:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Run the tests in a environment where `quarkus.flyway.clean-on-validation-error=true`. That allows to test all the migrations before releasing to another environment. Mostly useful in new services that do not share the database."
msgstr "Executar os testes num ambiente onde `quarkus.flyway.clean-on-validation-error=true`. Isso permite testar todas as migrações antes de liberar para outro ambiente. Muito útil em novos serviços que não partilham a base de dados."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Create independent migrations by feature. In this case, migrations should be small, and it will be easier to rollback. To avoid name collision between migrations of the same version, a timestamp in the name and `quarkus.flyway.out-of-order=true` might be used."
msgstr "Criar migrações independentes por caraterística. Neste caso, as migrações devem ser pequenas e será mais fácil efetuar o rollback. Para evitar a colisão de nomes entre migrações da mesma versão, pode ser utilizado um carimbo de data/hora no nome e em `quarkus.flyway.out-of-order=true`."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Our custom case (2)"
msgstr "A nossa mala personalizada (2)"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The management of users, roles, operations of all the systems is handled in one transversal security management system with his own database. When a backend exposes a new API, it defines a new operation and a `@RolesAllowed` annotation. It might also need to create new roles if needed. This new data must be persisted/updated in the security system database. We need to trigger such updates as part of the service CI/CD flow. To resolve this situation, the services need two folders of migrations: `db/migration` (for the service schema) and `db/migrationsecurity` (for the security database). At the security database, each service has its own \"flyway_schema_history\" table, to keep record of the migrations executed. For example \"fsh_service_A\", \"fsh_service_B\", etc."
msgstr "A gestão de utilizadores, funções e operações de todos os sistemas é tratada num sistema de gestão de segurança transversal com a sua própria base de dados. Quando um backend expõe uma nova API, define uma nova operação e uma anotação `@RolesAllowed`. Pode também ter de criar novas funções, se necessário. Estes novos dados devem ser mantidos/actualizados na base de dados do sistema de segurança. Temos de acionar essas actualizações como parte do fluxo de CI/CD do serviço. Para resolver esta situação, os serviços precisam de duas pastas de migrações: `db/migration` (para o esquema de serviço) e `db/migrationsecurity` (para a base de dados de segurança). Na base de dados de segurança, cada serviço tem a sua própria tabela \"flyway_schema_history\", para manter o registo das migrações executadas. Por exemplo, \"fsh_service_A\", \"fsh_service_B\", etc."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "How do we do it? The default `db/migration` folder is handled by Quarkus when running tests or deploying. On the other hand, the `db/migrationsecurity` is picked up by a GitLab job that runs before deploying the app to any environment. As the security database is shared across all the services in that environment, the Flyway configurations can be declared in a unified way as GitLab CI/CD variables. Another approach thay may also work is using the `quarkus.flyway.\"named-data-sources\"` properties, that let you apply migrations in different datasources."
msgstr "Como é que o fazemos? A pasta predefinida `db/migration` é gerida pelo Quarkus durante a execução de testes ou a implementação. Por outro lado, o `db/migrationsecurity` é recolhido por um trabalho GitLab que é executado antes de implementar a aplicação em qualquer ambiente. Como a base de dados de segurança é partilhada por todos os serviços nesse ambiente, as configurações do Flyway podem ser declaradas de uma forma unificada como variáveis CI/CD do GitLab. Outra abordagem que também pode funcionar é usar as propriedades `quarkus.flyway.\"named-data-sources\"`, que permitem aplicar migrações em diferentes fontes de dados."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Automatic testing and code analysis"
msgstr "Testes automáticos e análise de código"

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"To implement automated testing the `quarkus-junit5` extension is needed.\n"
"As mentioned above, our automated tests have to run against an existing database with all the necessary structures. For that reason, we are not able to set up test databases from scratch, for example using TestContainers. We also need to have a way to rollback the changes introduced by tests. Doing the latter is really easy thanks to the `@TestTransaction` annotation provided by Quarkus (see https://quarkus.io/guides/getting-started-testing#tests-and-transactions).\n"
"Transactional testing is really useful, as it allows us to run tests against a real database, without the need for mocking. Along with testing the methods logic, it also guarantees that the entities and tables are correctly defined."
msgstr "Para implementar testes automatizados, é necessária a extensão `quarkus-junit5` . Conforme mencionado acima, nossos testes automatizados precisam ser executados em um banco de dados existente com todas as estruturas necessárias. Por esse motivo, não podemos configurar bancos de dados de teste do zero, por exemplo, usando TestContainers. Também precisamos ter uma maneira de reverter as alterações introduzidas pelos testes. Fazer isso é muito fácil graças à anotação `@TestTransaction` fornecida pelo Quarkus ( link:https://quarkus.io/guides/getting-started-testing#tests-and-transactions[consulte https://quarkus.io/guides/getting-started-testing#tests-and-transactions)] . O teste transacional é realmente útil, pois nos permite executar testes em um banco de dados real, sem a necessidade de simulação. Além de testar a lógica dos métodos, ele também garante que as entidades e tabelas sejam definidas corretamente."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Regarding code analysis, we are using two Maven plugins: `sonar-maven-plugin` and `dependency-check-maven`. SonarQube is an open source platform developed by SonarSource for continuous inspection of code quality to perform automatic reviews with static analysis of code to detect bugs and code smells. Dependency-Check is a Software Composition Analysis tool that attempts to detect publicly disclosed vulnerabilities contained within a project's dependencies. A plugin can be installed in SonarQube to integrate with dependency check reports."
msgstr "Relativamente à análise de código, estamos a utilizar dois plugins Maven: `sonar-maven-plugin` e `dependency-check-maven`. O SonarQube é uma plataforma de código aberto desenvolvida pela SonarSource para a inspeção contínua da qualidade do código, para efetuar revisões automáticas com análise estática do código para detetar bugs e códigos mal cheirosos. Dependency-Check é uma ferramenta de análise de composição de software que tenta detetar vulnerabilidades divulgadas publicamente contidas nas dependências de um projeto. Um plugin pode ser instalado no SonarQube para se integrar com relatórios de verificação de dependências."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The `quarkus-jacoco` extension is also used to get the coverage of the tests. The generated report is picked up by SonarQube, and the results are used to check against the quality gate."
msgstr "A extensão `quarkus-jacoco` também é utilizada para obter a cobertura dos testes. O relatório gerado é recolhido pelo SonarQube e os resultados são utilizados para verificar a porta de qualidade."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Code analysis tools can take some time. For that reason, we decided to run this tasks only on nightly builds fired by GitLab scheduler. This decision depends on the requirements of each project."
msgstr "As ferramentas de análise de código podem levar algum tempo. Por esse motivo, decidimos executar essas tarefas apenas em compilações noturnas disparadas pelo agendador do GitLab. Esta decisão depende dos requisitos de cada projeto."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Dependency Bot"
msgstr "Bot de dependência"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We are living in an age of continuous delivery code, and Quarkus is no exception. The team is releasing new versions with improvements and bugfixes at a fast pace. In addition to that, we crafted some utility libraries that are shared among our backends and frontends. When there are new releases, all the services should be updated."
msgstr "Estamos a viver numa era de código de entrega contínua, e o Quarkus não é exceção. A equipa está a lançar novas versões com melhorias e correcções de erros a um ritmo acelerado. Além disso, criámos algumas bibliotecas de utilitários que são partilhadas entre os nossos backends e frontends. Quando há novos lançamentos, todos os serviços devem ser actualizados."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "As of today (initial phase), we have ≈30 services, but a lot more are expected in the near future. Having a dependency bot to help us update these dependencies and run automated validation tasks is a must."
msgstr "Atualmente (fase inicial), temos ≈30 serviços, mas são esperados muitos mais num futuro próximo. Ter um bot de dependências para nos ajudar a atualizar estas dependências e executar tarefas de validação automatizadas é uma necessidade."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "As we are working with GitLab, one of the recommended options is Renovatebot. See https://docs.renovatebot.com/. It is relatively easy to setup, works seamlessly with Java, and is highly customizable."
msgstr "Como estamos a trabalhar com o GitLab, uma das opções recomendadas é o Renovatebot. Veja  https://docs.renovatebot.com/  É relativamente fácil de configurar, funciona perfeitamente com Java e é altamente personalizável."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Security domains and DAO library"
msgstr "Domínios de segurança e biblioteca DAO"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "As part of the project, we had to code an utility JPA DAO library for simplifying the queries made by developers. As a result, the \"jpacriteria-dao\" library was born. Under the hoods, it uses the JPA criteria library."
msgstr "Como parte do projeto, tivemos de codificar uma biblioteca utilitária JPA DAO para simplificar as consultas feitas pelos programadores. Como resultado, nasceu a biblioteca \"jpacriteria-dao\". Nos bastidores, utiliza a biblioteca de critérios JPA."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The main goals are:"
msgstr "Os principais objectivos são:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Simplify the creation of queries. Developers only need to code DTO filters and map the attributes to criteria predicates. The library creates the final query. It automatically detects when to do inner/left joins, when to use distinct, etc."
msgstr "Simplificar a criação de consultas. Os programadores só precisam de codificar filtros DTO e mapear os atributos para critérios predicados. A biblioteca cria a consulta final. Detecta automaticamente quando fazer junções internas/esquerdas, quando usar distinct, etc."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Support the use of `includeFields` with navigation, so the developers can choose which fields to query (`field1.field2.id`, `field1.field2.name`, etc). Executes a native Query and maps the result to a DTO. It is very useful to limit the scope of the query."
msgstr "Suporta a utilização de `includeFields` com navegação, para que os programadores possam escolher os campos a consultar ( `field1.field2.id`, `field1.field2.name`, etc). Executa uma consulta nativa e mapeia o resultado para um DTO. É muito útil para limitar o escopo da consulta."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "In our system, we have security domains, with precedence. Some users must only see the data that belongs to their domain. The library, when instructed, can do the validations and filtering automatically at DAO level. Entities that need to support that must extend the `DataSecurity` interface."
msgstr "No nosso sistema, temos domínios de segurança, com precedência. Alguns utilizadores só podem ver os dados que pertencem ao seu domínio. A biblioteca, quando instruída, pode fazer as validações e filtragens automaticamente ao nível do DAO. As entidades que necessitem de suportar isso devem estender a interface `DataSecurity`."

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"We decided to open source it, and it will probably be also deployed to Maven Central. The code is published in the https://github.com/sofisslat/jpacriteria-dao GitHub repository.\n"
"We also uploaded an example Quarkus app using the library (under the folder `example`). As of today, we see the library as a proof of concept, that can be evolved and improved."
msgstr "Decidimos abrir o código-fonte e provavelmente ele também será implantado no Maven Central. O código está publicado no repositório https://github.com/sofisslat/jpacriteria-dao do GitHub. Também fizemos o upload de um aplicativo Quarkus de exemplo usando a biblioteca (na pasta `example` ). Até o momento, vemos a biblioteca como uma prova de conceito, que pode ser desenvolvida e aprimorada."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Logs (EFK)"
msgstr "Registos (EFK)"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "When running multiple services and applications on a Kubernetes cluster, a centralized, cluster-level logging stack can help to quickly sort through and analyze the heavy volume of log data produced by the pods. One popular centralized logging solution is the Elasticsearch, Fluentd, and Kibana (EFK) stack. Data streams are the recommended way of storing logs in Elasticsearch. In a typical setup, all the logs have useful context information used for filtering as \"namespace\", \"service\", \"log level\", etc."
msgstr "Ao executar vários serviços e aplicativos em um cluster Kubernetes, uma pilha de log centralizada no nível do cluster pode ajudar a classificar e analisar rapidamente o grande volume de dados de log produzidos pelos pods. Uma solução de registro centralizado popular é a pilha Elasticsearch, Fluentd e Kibana (EFK). Os fluxos de dados são a maneira recomendada de armazenar logs no Elasticsearch. Em uma configuração típica, todos os logs têm informações de contexto úteis usadas para filtragem como \"namespace\", \"serviço\", \"nível de log\" etc."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The challenge lies in adding as much context as possible to the logged information, such as:"
msgstr "O desafio consiste em acrescentar o máximo de contexto possível às informações registadas, por exemplo:"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "traceId (link logs corresponding to a trace of invocations)"
msgstr "traceId (registos de ligação correspondentes a um traço de invocações)"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "tokenId (link logs corresponding to a JWT authorization token)"
msgstr "tokenId (registos de ligação correspondentes a um token de autorização JWT)"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "userId/userCode (link logs corresponding to a given user)"
msgstr "userId/userCode (ligação dos registos correspondentes a um determinado utilizador)"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "This additional information helps our development team to debug errors reported by users."
msgstr "Estas informações adicionais ajudam a nossa equipa de desenvolvimento a depurar os erros comunicados pelos utilizadores."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "JSON logging format"
msgstr "Formato de registo JSON"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "It is possible to change the output format of the console log. This can be useful in environments where the output of the Quarkus application is captured by a service which processes and stores the log information for later analysis. In order to configure the JSON logging format, the `quarkus-logging-json` extension may be employed. See https://quarkus.io/guides/logging#json-logging."
msgstr "É possível alterar o formato de saída do registo da consola. Isto pode ser útil em ambientes onde a saída da aplicação Quarkus é capturada por um serviço que processa e armazena as informações de registo para análise posterior. Para configurar o formato de registo JSON, pode ser utilizada a extensão `quarkus-logging-json`. Ver  https://quarkus.io/guides/logging#json-logging"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "In our case, this allowed us to add some extra parameters to the JSON log output, that are easily picked up by fluentd and sent to Elasticsearch."
msgstr "No nosso caso, isto permitiu-nos adicionar alguns parâmetros extra à saída de registo JSON, que são facilmente captados pelo fluentd e enviados para o Elasticsearch."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The `quarkus.log.console.json.exception-output-type=formatted` property is also used to send the stacktrace."
msgstr "A propriedade `quarkus.log.console.json.exception-output-type=formatted` também é utilizada para enviar o stacktrace."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "Docker has a size limit of 16K for logs (https://github.com/kubernetes/kubernetes/issues/52444[kubernetes/kubernetes#52444] and https://github.com/moby/moby/issues/34620[moby/moby#34620]). An error with a large stacktrace is going to generate a split log. The proposed fluentd community solution is using the fluent-plugin-concat. Keep in mind that there are edge cases with rotating file logs when it might fail. Another solution is sending the logs directly as mentioned in https://quarkus.io/guides/centralized-log-management."
msgstr "O Docker tem um limite de tamanho de 16K para logs link:https://github.com/kubernetes/kubernetes/issues/52444[(kubernetes/kubernetes#52444] e  link:https://github.com/moby/moby/issues/34620[moby/moby#34620]). Um erro com um stacktrace grande vai gerar um log dividido. A solução proposta pela comunidade fluentd é usar o fluent-plugin-concat. Tenha em mente que há casos extremos com logs de arquivos rotativos quando isso pode falhar. Outra solução é enviar os logs diretamente como mencionado em  https://quarkus.io/guides/centralized-log-management"

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "MDC (Mapped diagnostic context)"
msgstr "MDC (contexto de diagnóstico mapeado)"

#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid ""
"The typical Java logging API lets you log the level, exception message and stacktrace. Quarkus uses JBoss Log Manager under the hoods. Using `org.jboss.logmanager.MDC`, we have access to the `MDC.put(String key, String value)` method that allows us to add key-value parameters.\n"
"In order to set this information, a `javax.ws.rs.container.ContainerRequestFilter` should be implemented."
msgstr "A API de registro típica do Java permite que o usuário registre o nível, a mensagem de exceção e o stacktrace. O Quarkus usa o JBoss Log Manager sob os capuzes. Usando `org.jboss.logmanager.MDC` , temos acesso ao método `MDC.put(String key, String value)` que nos permite adicionar parâmetros de valor-chave. Para definir essas informações, um `javax.ws.rs.container.ContainerRequestFilter` deve ser implementado."

#. type: Title ===
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Obtaining the parameters"
msgstr "Obtenção dos parâmetros"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The tokenId, userId and userCode are obtained from the JsonWebToken used to invoke the API."
msgstr "O tokenId, o userId e o userCode são obtidos a partir do JsonWebToken utilizado para invocar a API."

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "The traceId, is generated by the `quarkus-opentelemetry` extension. The extension is responsible for transparently propagating the trace through the different REST invocations that are made from the backends. We wanted to use the traceId only for logging, without an external visualizing tool like Jaeger, so we disabled the OTLP Exporter with `quarkus.opentelemetry.tracer.exporter.otlp.enabled=false`."
msgstr "O traceId é gerado pela extensão `quarkus-opentelemetry`. A extensão é responsável por propagar de forma transparente o trace através das diferentes invocações REST que são feitas a partir dos backends. Queríamos utilizar o traceId apenas para registo, sem uma ferramenta de visualização externa como o Jaeger, pelo que desactivámos o exportador OTLP com `quarkus.opentelemetry.tracer.exporter.otlp.enabled=false`."

#. type: Title ==
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy, no-wrap
msgid "Final thoughts"
msgstr "Considerações finais"

#. type: Plain text
#: _posts/2023-05-09-ministry-of-economy-finance-uruguay-adopts-quarkus.adoc
#, fuzzy
msgid "We initially adopted Thorntail (previously known as Wildfly-Swarm) for our service-oriented architecture projects, but switched to Quarkus at the beginning of its 1.x release due to its superior features. Quarkus has proven to be an excellent choice for us, and we have greatly enjoyed working with it and its extensions over the past few years. As of today, the new base architecture is already defined, and SIIF started its migration. At least 5 more years of work with it and other internal systems is expected. Undoubtedly, we will continue working and improving this architecture for the years to come, aligned with the Quarkus ecosystem. We extend our gratitude to the entire Quarkus team and the enthusiastic community behind the project, of which we are proud to be a part."
msgstr "Inicialmente adoptámos o Thorntail (anteriormente conhecido como Wildfly-Swarm) para os nossos projectos de arquitetura orientada a serviços, mas mudámos para o Quarkus no início da sua versão 1.x devido às suas características superiores. O Quarkus provou ser uma excelente escolha para nós, e gostámos muito de trabalhar com ele e com as suas extensões nos últimos anos. A partir de hoje, a nova arquitetura de base já está definida e o SIIF iniciou a sua migração. Esperam-se, pelo menos, mais 5 anos de trabalho com ela e com outros sistemas internos. Sem dúvida, continuaremos a trabalhar e a melhorar esta arquitetura nos próximos anos, em linha com o ecossistema Quarkus. Agradecemos a toda a equipa Quarkus e à comunidade entusiasta por detrás do projeto, da qual nos orgulhamos de fazer parte."
